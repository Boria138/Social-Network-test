# История обновлений Voxii

Все значимые изменения в проекте задокументированы в этом файле.

## [1.2.0] - 2026-02-25

### Добавлено
- **Markdown изображения** — добавлена поддержка синтаксиса `![alt](url)` для вставки изображений
- **HTML блоки в markdown** — добавлена поддержка многозначных HTML блоков (`<div>`, `<p>`, `<section>`, etc.)
  - Сохранение структуры HTML при форматировании
  - Поддержка атрибута `align` для центрирования контента
  - Центрирование изображений, заголовков и ссылок внутри `<div align="center">`
  - Автоматическая замена `<br>` на горизонтальный разделитель `<hr>` между блоками
  - Поддержка текста описания в `<p>` с сохранением переносов строк

### Исправлено
- **Система цитирования сообщений** — исправлена работа выделения текста для ответов
  - Кнопка ответа теперь появляется только при выделении текста внутри сообщений
  - При ответе отправляется только выделенный фрагмент, а не всё сообщение целиком
  - Убрана функция `isReplyDisabled()` — она ломала ответы в обычных чатах после перехода из канала новостей

- **Редактирование сообщений** — исправлено повторное редактирование
  - При повторном редактировании берётся текущий текст из сообщения, а не оригинальный
  - Индикатор «(изменено)» теперь корректно удаляется при редактировании
  - Исправлен перевод индикатора редактирования (используется i18n)
  - Убраны лишние скобки вокруг индикатора редактирования

- **Link Preview** — URL из markdown изображений `![alt](url)` больше не создают превью ссылок

- **i18n** — исправлена функция перевода
  - Функция `window.i18n.t()` теперь использует текущий язык по умолчанию

- **Новости** — сообщения канала новостей теперь используют общую функцию форматирования markdown
  - Добавлена поддержка inline code (`code`), курсива, заголовков, списков и изображений
  - Убрано дублирование кода форматирования

---

## [1.1.0] - 2026-02-24

### Добавлено
- **Система уведомлений** — полноценная система уведомлений для сообщений и звонков
  - Браузерные push-уведомления (работают даже при закрытой вкладке)
  - Звуковые уведомления для сообщений и входящих звонков
  - Счетчик непрочитанных сообщений на иконке кнопки уведомлений
  - Бейджи с количеством непрочитанных на аватарах в списке контактов
  - Панель уведомлений с историей пропущенных звонков и сообщений
  - Сохранение уведомлений в базе данных (синхронизация между устройствами)
  - Индикаторы непрочитанных в DM списке

### Технические изменения
- Добавлена таблица БД `notifications` для хранения уведомлений
- Добавлены API endpoints для работы с уведомлениями:
  - `GET /api/notifications` — получить все уведомления пользователя
  - `GET /api/notifications/unread` — получить непрочитанные уведомления
  - `POST /api/notifications/mark-all-read` — отметить все как прочитанные
  - `POST /api/notifications/mark-user-read` — отметить уведомления от пользователя
  - `DELETE /api/notifications/:id` — удалить уведомление
  - `DELETE /api/notifications` — удалить все уведомления
- Добавлен модуль `notification-service.js` на клиенте
- Обновлен интерфейс: добавлена кнопка уведомлений с бейджем
- Сервер теперь сохраняет пропущенные звонки в базу данных
- Применено применение Twemoji к новостным сообщениям

### Изменено
- Уменьшен размер кнопок в панели пользователя для размещения кнопки уведомлений

---

## [1.0.0] - 2026-02-23

### Добавлено
- **Системный канал «Новости»** — официальный канал для объявлений и обновлений платформы
  - Принудительная подписка всех пользователей (без возможности отписки)
  - Автоматическое создание при инициализации базы данных
  - Новые пользователи автоматически подписываются при регистрации

### Технические изменения
- Добавлены таблицы БД: `channels`, `channel_subscriptions`, `channel_messages`
- Добавлены API endpoints для работы с каналами:
  - `GET /api/channels` — получить все каналы пользователя
  - `GET /api/channels/system` — получить системный канал
  - `GET /api/channels/:channelId/messages` — получить сообщения канала
  - `POST /api/channels/:channelId/messages` — отправить сообщение в канал
- Добавлены Socket.IO события для real-time обновлений каналов:
  - `send-channel-message` — отправка сообщения
  - `new-channel-message` — получение нового сообщения
- Обновлён интерфейс клиента для отображения системного канала
- Добавлены стили для выделения системного канала (оранжевый градиент)

---

## [0.9.0] - 2026-02-22

### Добавлено
- Подсветка синтаксиса кода (Code Highlight)
- Переработана система ответов на сообщения
- Предпросмотр ссылок (OG Preview)
- Полноценная поддержка Markdown в сообщениях

### Изменено
- Форматирование URL-адресов
- Исправлены временные метки сообщений

---

## [0.8.0] - 2026-02-20

### Добавлено
- Голосовые сообщения с отдельной кнопкой отправки
- Исправлена высота голосовых сообщений

### Изменено
- Замена `sqlite3` на `better-sqlite3` для повышения производительности
- Обновлена версия Node.js до 20 для устранения уязвимостей
- Исправлены проблемы с Socket.IO

---

## [0.7.0] - 2026-02-15

### Добавлено
- Начальная поддержка голосовых сообщений

### Изменено
- Убран градиент из пустых сообщений
- Исправлены кнопки управления в звонках
- Исправлены проблемы с WebRTC

---

## [0.6.0] - 2026-02-13

### Изменено
- Исправлен перевод в само-чате
- Добавлено редактирование и удаление сообщений
- Добавлен градиент к сообщениям пользователей
- Добавлена поддержка перевода (i18n)
- Исправлены временные метки сообщений
- Обновлён скрипт деплоя
- Добавлена мобильная адаптация

---

## [0.5.0] - 2026-02-07

### Добавлено
- Улучшенные стили интерфейса
- Дополнительные цветовые темы

---

## [0.4.0] - 2026-02-04

### Добавлено
- Прикрепление файлов к сообщениям (изображения, документы, аудио, видео)

---

## [0.3.0] - 2026-02-03

### Добавлено
- Система ответов на сообщения (reply)
- Локальный само-чат (Self Chat) для заметок

### Удалено
- Система каналов (упрощение архитектуры)

---

## [0.2.0] - 2026-01-29

### Изменено
- Полный редизайн интерфейса
- Текстовое поле (textarea) для ввода сообщений
- Исправлена загрузка реакций при старте

### Удалено
- PWA функциональность

### Добавлено
- Twemoji для отображения эмодзи
- Постоянное хранилище сессий

---

## [0.1.0] - 2026-01-28

### Добавлено
- Первый релиз Voxii
- Базовая функциональность чата
- Аутентификация пользователей
- Личные сообщения (DM)
- Реакции на сообщения

---

## Формат журнала изменений

Этот проект следует формату [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/).

### Типы изменений
- **Добавлено** — новые функции
- **Изменено** — изменения в существующем функционале
- **Удалено** — удалённый функционал
- **Исправлено** — исправления ошибок
